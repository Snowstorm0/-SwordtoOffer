<!-- GFM-TOC -->

* [网络的网络](#网络的网络)
* [ISP](#isp)
* [主机之间的通信方式](#主机之间的通信方式)
* [电路交换与分组交换](#电路交换与分组交换)
    * [1. 电路交换](#1-电路交换)
    * [2. 分组交换](#2-分组交换)
* [时延](#时延)
    * [1. 排队时延](#1-排队时延)
    * [2. 处理时延](#2-处理时延)
    * [3. 传输时延](#3-传输时延)
    * [4. 传播时延](#4-传播时延)
* [计算机网络体系结构](#计算机网络体系结构)
* [计算机网络体系结构](#计算机网络体系结构)
    * [1. 五层协议](#1-五层协议)
    * [2. OSI](#2-osi)
    * [3. TCP/IP](#3-tcpip)
    * [4. 数据在各层之间的传递过程](#4-数据在各层之间的传递过程)
* [TCP、IP数据链路层的交互过程](#TCPIP数据链路层的交互过程)
* [浏览器输入一个URL](#浏览器输入一个URL)



<!-- GFM-TOC -->

# 网络的网络

网络把主机连接起来，而互连网（internet）是把多种不同的网络连接起来，因此互连网是网络的网络。而互联网（Internet）是全球范围的互连网。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/network-of-networks.gif" width="450"/> </div><br>

# ISP

互联网服务提供商 ISP(Internet Service Provider) 可以从互联网管理机构获得许多 IP 地址，同时拥有通信线路以及路由器等联网设备，个人或机构向 ISP 缴纳一定的费用就可以接入互联网。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/72be01cd-41ae-45f7-99b9-a8d284e44dd4.png" width="500"/> </div><br>

目前的互联网是一种多层次 ISP 结构，ISP 根据覆盖面积的大小分为第一层 ISP、区域 ISP 和接入 ISP。互联网交换点 IXP(Internet Exchange Point) 允许两个 ISP 直接相连而不用经过第三个 ISP。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/3be42601-9d33-4d29-8358-a9d16453af93.png" width="500"/> </div><br>

# 主机之间的通信方式

- 客户-服务器（C/S, Client/Server）：客户是服务的请求方，服务器是服务的提供方。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/914894c2-0bc4-46b5-bef9-0316a69ef521.jpg" width="240px"> </div><br>

- 对等（P2P, Peer to Peer）：不区分客户和服务器。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/42430e94-3137-48c0-bdb6-3cebaf9102e3.jpg" width="200px"> </div><br>

# 电路交换与分组交换

## 1. 电路交换

电路交换用于**电话通信系统**，两个用户要通信之前需要建立一条专用的物理链路，并且在整个通信过程中始终占用该链路。由于通信的过程中不可能一直在使用传输线路，因此电路交换对线路的利用率很低，往往不到 10%。

## 2. 分组交换

每个分组都有首部和尾部，包含了源地址和目的地址等控制信息，在同一个传输线路上**同时传输多个分组**互相不会影响，因此在同一条传输线路上允许同时传输多个分组，也就是说分组交换不需要占用传输线路。

在一个邮局通信系统中，邮局收到一份邮件之后，先存储下来，然后把相同目的地的邮件**一起转发**到下一个目的地，这个过程就是存储转发过程，分组交换也使用了存储转发过程。

# 时延

总时延 = 排队时延 + 处理时延 + 传输时延 + 传播时延

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/4b2ae78c-e254-44df-9e37-578e2f2bef52.jpg" width="380"/> </div><br>

## 1. 排队时延

分组在路由器的**输入队列和输出队列**中排队等待的时间，取决于网络当前的通信量。

## 2. 处理时延

主机或路由器收到分组时进行处理所需要的时间，例如分析首部、从分组中提取数据、进行差错检验或查找适当的路由等。

## 3. 传输时延

主机或路由器**传输数据帧**所需要的时间。

<!-- <div align="center"><img src="https://latex.codecogs.com/gif.latex?delay=\frac{l(bit)}{v(bit/s)}" class="mathjax-pic"/></div> <br> -->

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/dcdbb96c-9077-4121-aeb8-743e54ac02a4.png" width="150px"> </div><br>


其中 l 表示数据帧的长度，v 表示传输速率。

## 4. 传播时延

**电磁波**在信道中传播所需要花费的时间，电磁波传播的速度接近光速。

<!-- <div align="center"><img src="https://latex.codecogs.com/gif.latex?delay=\frac{l(m)}{v(m/s)}" class="mathjax-pic"/></div> <br> -->

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/a1616dac-0e12-40b2-827d-9e3f7f0b940d.png" width="150"> </div><br>

其中 l 表示信道长度，v 表示电磁波在信道上的传播速度。

# 计算机网络体系结构

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/0fa6c237-a909-4e2a-a771-2c5485cd8ce0.png" width="450"/> </div><br>

## 1. 五层协议

-   **应用层**  ：为特定应用程序提供数据传输服务，例如 **HTTP(HyperText Transfer Protocol,超文本传输协议)**、**DNS(Domain Name System,域名系统协议)** 等协议。数据单位为**报文**。

-   **传输层**  ：为进程提供通用数据传输服务。由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。运输层包括两种协议：**传输控制协议 TCP(Transmission Control Protocol)**，提供面向**连接、可靠**的数据传输服务，数据单位为**报文段**；**用户数据报协议 UDP(User Datagram Protocol)**，提供**无连接、尽最大努力**的数据传输服务，数据单位为**用户数据报**。TCP 主要提供**完整性服务**，UDP 主要提供**及时性服务**。

-   **网络层**  ：为主机之间提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。网络层把传输层传递下来的**报文段或者用户数据报封装成分组(IP数据报)**。

-   **数据链路层**  ：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为**同一链路的主机**提供数据传输服务。数据链路层**把网络层传下来的分组(IP数据报)封装成帧**。

-   **物理层**  ：考虑的是怎样在传输媒体上**传输数据比特流**，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。

## 2. OSI**(开放系统互联Open System Interconnection)**

其中表示层和会话层用途如下：

-   **表示层**  ：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。

-   **会话层**  ：建立及管理会话。

五层协议没有表示层和会话层，而是将这些功能留给应用程序开发者处理。

## 3. TCP/IP

它只有四层，相当于五层协议中**数据链路层和物理层合并为网络接口层**。

TCP/IP 体系结构不严格遵循 OSI 分层概念，应用层可能会直接使用 IP 层或者网络接口层。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/48d79be8-085b-4862-8a9d-18402eb93b31.png" width="250"/> </div><br>

## 4. 数据在各层之间的传递过程

在向下的过程中，需要**添加下层协议所需要的首部或者尾部**，而在向上的过程中**不断拆开首部和尾部**。

路由器只有下面三层协议，因为路由器位于网络核心中，不需要为进程或者应用程序提供服务，因此也就不需要应用层和传输层。



# TCP、IP数据链路层的交互过程


网络层等到数据链层用 mac 地址作为通信目标，数据包到达网络等准备往数据链层发送的时候，首先会去自己的 arp 缓存表(存着 ip-mac 对应关系)去查找改目标 ip 的 mac 地址，如果查到了，就讲目标 ip 的 mac 地址封装到链路层数据包的包头。如果缓存中没有找到，会发起一个广播：`who is ip XXX tell ip XXX`,所有收到的广播的机器看这个 ip 是不是自己的，如果是自己的，则以单拨的形式将自己的 mac 地址回复给请求的机器





# 浏览器输入一个URL

从浏览器输入一个URL（www.baidu.com）的全过程：

1. 根据域名到 DNS 中找到 IP
2. 根据 IP 建立 TCP 连接(三次握手)
3. 连接建立成功发起 http 请求
4. 服务器响应 http 请求
5. 浏览器解析 HTML 代码并请求 html 中的静态资源（js,css）
6. 关闭TCP连接（四次挥手）
7. 浏览器渲染页面

浏览器要将 URL 解析为 IP 地址，解析域名就要用到 DNS 协议，首先主机会查询 DNS 的缓存，如果没有就给本地 DNS 发送查询请求。DNS 查询分为两种方式，一种是递归查询，一种是迭代查询。如果是迭代查询，本地的 DNS 服务器，向根域名服务器发送查询请求，根域名服务器告知该域名的一级域名服务器，然后本地服务器给该一级域名服务器发送查询请求，然后依次类推直到查询到该域名的 IP 地址。DNS 服务器是基于 UDP 的，因此会用到 UDP 协议。

得到 IP 地址后，浏览器就要与服务器建立一个 http 连接。因此要用到 http 协议，http 协议报文格式上面已经提到。http 生成一个 get 请求报文，将该报文传给 TCP 层处理，所以还会用到 TCP 协议。如果采用 https 还会使用 https 协议先对 http 数据进行加密。TCP 层如果有需要先将 HTTP 数据包分片，分片依据路径 MTU 和 MSS。TCP 的数据包然后会发送给 IP 层，用到 IP协议。IP 层通过路由选路，一跳一跳发送到目的地址。当然在一个网段内的寻址是通过以太网协议实现(也可以是其他物理层协议，比如 PPP，SLIP)，以太网协议需要直到目的 IP 地址的物理地址，有需要 ARP 协议。

其中：

1、DNS 协议，http 协议，https 协议属于**应用层**

应用层是体系结构中的最高层。应用层确定进程之间通信的性质以满足用户的需要。这里的进程就是指正在运行的程序。应用层不仅要提供应用进程所需要的信息交换和远地操作，而且还要作为互相作用的应用进程的用户代理，来完成一些为进行语义上有意义的信息交换所必须的功能。应用层直接为用户的应用进程提供服务。

2、TCP/UDP 属于**传输层**

传输层的任务就是负责主机中两个进程之间的通信。因特网的传输层可使用两种不同协议：即面向连接的传输控制协议 TCP，和无连接的用户数据报协议 UDP。面向连接的服务能够提供可靠的交付，但无连接服务则不保证提供可靠的交付，它只是“尽最大努力交付”。这两种服务方式都很有用，备有其优缺点。在分组交换网内的各个交换结点机都没有传输层。

3、IP 协议，ARP 协议属于**网络层**

网络层负责为分组交换网上的不同主机提供通信。在发送数据时，网络层将运输层产生的报文段或用户数据报封装成分组或包进行传送。在 TCP/IP 体系中，分组也叫作 IP 数据报，或简称为数据报。网络层的另一个任务就是要选择合适的路由，使源主机运输层所传下来的分组能够交付到目的主机。

4、**数据链路层**

当发送数据时，数据链路层的任务是将在网络层交下来的 IP 数据报组装成帧，在两个相邻结点间的链路上传送以帧为单位的数据。每一帧包括数据和必要的控制信息（如同步信息、地址信息、差错控制、以及流量控制信息等）。控制信息使接收端能够知道—个帧从哪个比特开始和到哪个比特结束。控制信息还使接收端能够检测到所收到的帧中有无差错。

5、**物理层**

物理层的任务就是透明地传送比特流。在物理层上所传数据的单位是比特。传递信息所利用的一些物理媒体，如双绞线、同轴电缆、光缆等，并不在物理层之内而是在物理层的下面。因此也有人把物理媒体当做第 0 层。









